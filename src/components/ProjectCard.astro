---
import Badge from "@components/Badge.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

interface Props {
  name: string;
  role: "author" | "contributor" | "maintainer";
  url?: string;
  description: string | null;
  languages: string[];
  website: string | null;
  image?: string;
  cahierDesCharges?: string;
  competencesDeveloppees?: string;
}

const colors = {
  maintainer: "gradient-pink",
  author: "gradient-indigo",
  contributor: "green",
} as const;

const { name, role, url, description, languages, website, image, cahierDesCharges, competencesDeveloppees } = Astro.props;
---

<li
  class="repo-card group relative overflow-hidden dark:text-neutral-400 text-neutral-500 gap-1 p-6 border dark:border-neutral-700/60 border-neutral-200/80 rounded-xl flex flex-col bg-white/30 dark:bg-neutral-800/30 shadow-sm hover:shadow-md transition-all duration-300 backdrop-blur-sm"
>
  <div class="absolute inset-0 bg-grid-pattern opacity-5 dark:opacity-10"></div>

  <div
    class="absolute inset-0 bg-gradient-to-r from-transparent via-neutral-200/20 to-transparent dark:from-transparent dark:via-neutral-600/10 dark:to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"
  >
  </div>

  <div class="flex justify-between items-start z-10">
    <div class="flex flex-col sm:flex-row sm:items-baseline gap-2">
      <h2
        class="text-lg font-medium dark:text-white text-neutral-800 [word-break:break-word] group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-300"
      >
        {name}
      </h2>
      <Badge text={role} color={colors[role]} />
    </div>
    <div class="flex gap-2">
      {
        url && (
          <a
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            aria-label={`Open ${name} repository in a new tab`}
            class="relative repo-icon-link"
          >
            <Icon
              name="mdi:github"
              class="w-6 fill-current dark:hover:text-neutral-50 hover:text-neutral-800 transition-all duration-300 transform hover:scale-110"
            />
          </a>
        )
      }
      {
        website && (
          <a
            href={website}
            target="_blank"
            rel="noopener noreferrer"
            aria-label={`Open ${name} website in a new tab`}
            class="relative repo-icon-link"
          >
            <Icon
              name="mdi:web"
              class="w-6 fill-current dark:hover:text-neutral-50 hover:text-neutral-800 transition-all duration-300 transform hover:scale-110"
            />
          </a>
        )
      }
    </div>
  </div>

  {
    image && (
      <div class="mt-4 rounded-lg overflow-hidden">
        <img
          src={(() => {
            const base = import.meta.env.BASE_URL || "/";
            const basePath = base.endsWith("/") ? base.slice(0, -1) : base;
            // S'assurer que le chemin de l'image commence par /
            const imagePath = image.startsWith("/") ? image : `/${image}`;
            return `${basePath}${imagePath}`;
          })()}
          alt={`${name} project image`}
          class="w-full h-auto object-cover"
          loading="lazy"
        />
      </div>
    )
  }

  {
    cahierDesCharges && (
      <div class="mt-4">
        <h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2">
          Cahier des charges
        </h3>
        <p class="leading-relaxed text-neutral-600 dark:text-neutral-300">
          {cahierDesCharges}
        </p>
      </div>
    )
  }

  {
    competencesDeveloppees && (
      <div class="mt-4">
        <h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2">
          Compétences développées
        </h3>
        <p class="leading-relaxed text-neutral-600 dark:text-neutral-300 whitespace-pre-line">
          {competencesDeveloppees}
        </p>
      </div>
    )
  }

  <ul class="flex flex-wrap gap-2 mt-3">
    {
      languages.map((item) => (
        <li class="text-xs font-medium dark:bg-neutral-700/80 bg-neutral-100 text-neutral-600 dark:text-neutral-200 rounded-full px-3 py-1 transition-all duration-300 hover:bg-neutral-200 dark:hover:bg-neutral-600 cursor-default">
          {item}
        </li>
      ))
    }
  </ul>
</li>
