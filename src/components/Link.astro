---
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"a"> {
  text: string;
  addClass?: string;
}
const { text, addClass, href, ...props } = Astro.props;

// Construire l'URL correcte avec le base
const base = import.meta.env.BASE_URL || "/";
let finalHref: string | URL | null | undefined = href;
if (href && typeof href === "string" && href.startsWith("/")) {
  // Pr√©fixer avec le base si c'est un chemin absolu
  const basePath = base.endsWith("/") ? base.slice(0, -1) : base;
  const path = href === "/" ? "/" : href;
  finalHref = basePath + path;
} else if (href instanceof URL) {
  finalHref = href;
}

let isActive: boolean;
if (!href) {
  isActive = false;
} else if (href === "/") {
  const basePath = base.endsWith("/") ? base.slice(0, -1) : base;
  isActive = Astro.url.pathname === base || Astro.url.pathname === basePath;
} else {
  const hrefPath = typeof href === "string" ? href : href.href;
  const basePath = base.endsWith("/") ? base.slice(0, -1) : base;
  const fullPath = basePath + (hrefPath.startsWith("/") ? hrefPath : "/" + hrefPath);
  isActive = Astro.url.pathname.includes(fullPath) || Astro.url.pathname.includes(hrefPath);
}
---

<a
  class:list={[
    "px-4 py-2 text-sm font-medium",
    {
      "dark:text-blue-400 text-blue-600 border-b-2 border-blue-400 dark:border-blue-600":
        isActive,
    },
    { "dark:text-neutral-300 text-neutral-600": !isActive },
    addClass,
  ]}
  aria-current={isActive ? "page" : undefined}
  href={finalHref}
  {...props}
  aria-label={`Go to ${text} page`}
>
  {text}
</a>
